(()=>{var R=Object.create;var f=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var L=Object.getOwnPropertyNames;var A=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var D=t=>f(t,"__esModule",{value:!0});var O=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var V=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of L(e))!z.call(t,n)&&(r||n!=="default")&&f(t,n,{get:()=>e[n],enumerable:!(o=C(e,n))||o.enumerable});return t},q=(t,e)=>V(D(f(t!=null?R(A(t)):{},"default",!e&&t&&t.__esModule?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var T=O((P,E)=>{function B(t,e,r=n=>n,o){let n=r,s=[];for(let i=0;i<t.length;i+=1){let c=i-e,a=c>=0?c:0,d=i+e+1,h=0,p=0;for(let m=a;m<d&&m<t.length;m+=1)p+=n(t[m]),h+=1;s[i]=o?o(t[i],p/h):p/h}return s}E.exports=B});function l(...t){if(!(t==null?void 0:t.length))throw new Error("No stream was passed");t.forEach(e=>e.getTracks().forEach(r=>{r.stop(),r.dispatchEvent(new Event("ended")),e.removeTrack(r),e.dispatchEvent(new Event("removetrack"))}))}function g(t){return navigator.mediaDevices.getUserMedia(t)}function M(t,e){let[r]=t.getAudioTracks(),o=new MediaStream([r]),n=new AudioContext,s=n.createMediaStreamSource(o),i=n.createMediaStreamDestination(),c=n.createGain();c.gain.value=e,[s,c,i].reduce((d,h)=>d&&d.connect(h));let[a]=i.stream.getAudioTracks();return t.removeTrack(r),t.addTrack(a),()=>{l(t),l(o),l(i.stream),i.disconnect(),s.disconnect(),n.state!=="closed"&&n.close()}}function y(t,e){return t.getAudioTracks().forEach(r=>e.addTrack(r)),e}function S(t,e){t.getTracks().forEach(r=>r.contentHint=e)}var w=q(T());var u={lineCap:"round",gap:5,lineWidth:10,maxLines:40,bufferSize:512};function H(t,e,r){let o=(0,w.default)(r,4),{gap:n,lineCap:s,lineWidth:i}=u,{width:c,height:a}=t;Object.assign(e,{lineWidth:i,lineCap:s}),e.clearRect(0,0,c,a),e.fillStyle="#09070D",e.fillRect(0,0,c,a),e.strokeStyle="#fff",o.forEach((d,h)=>{let p=Math.min(Math.max(d,0),a/3),m=n*(h+1);m>c-n||(e.beginPath(),e.moveTo(m,a/2+p),e.lineTo(m,a/2-p),e.stroke())})}async function k(t,e,r){try{let a=function(){!c||(requestAnimationFrame(a),n.getByteFrequencyData(i),H(t,e,i))};u.lineWidth=Math.round(t.width/130),u.gap=Math.round(t.width/(u.lineWidth*2)),u.maxLines=Math.round(t.width/(u.gap-u.lineWidth));let o=new AudioContext,n=o.createAnalyser();n.fftSize=u.bufferSize,n.minDecibels=-90,n.maxDecibels=20,n.smoothingTimeConstant=.85;let s=r.clone();o.createMediaStreamSource(s).connect(n);let i=new Uint8Array(n.frequencyBinCount).slice(0,u.maxLines),c=!0;r.addEventListener("removetrack",()=>{l(s),console.info("Stopping canvas drawing"),e.clearRect(0,0,t.width,t.height),c=!1}),requestAnimationFrame(a)}catch(o){console.error(o)}}function b(t,e){let r=document.createElement("canvas");if(!(r==null?void 0:r.captureStream))throw new Error("This browser does not support captureStream");let o=16/9,n=720;r.width=n*o,r.height=n;let s=r.getContext("2d");k(r,s,t);let i=r.captureStream(e);return S(i,"detail"),i}var x={constraints:{audio:!0},fps:24},v=class{options=x;recorder;chunks=[];constructor(e){this.options=Object.assign(x,e)}async init(){this.destroy();let{constraints:e,recorder:r,amplify:o,fps:n}=this.options,s=await g(e),i=b(s,n),c=y(s,i),a;o&&o>1&&(a=M(c,o)),this.recorder=new MediaRecorder(c,r),this.recorder.addEventListener("stop",()=>{l(c,s,i),a==null||a()}),this.recorder.addEventListener("dataavailable",d=>d.data.size>0&&this.chunks.push(d.data))}start(){var e;(e=this.recorder)==null||e.start()}stop(){let e=this.recorder;if(!(!e||(e==null?void 0:e.state)==="inactive"))return new Promise(r=>{e.addEventListener("stop",()=>{let o=new Blob(this.chunks,{type:e.mimeType});r(o)}),e.stop()})}destroy(){this.recorder&&(this.recorder.stop(),this.recorder=void 0),this.chunks=[]}on(e,r,o){var n;(n=this.recorder)==null||n.addEventListener(e,r,o)}off(e,r,o){var n;(n=this.recorder)==null||n.removeEventListener(e,r,o)}emit(e){var r;(r=this.recorder)==null||r.dispatchEvent(new Event(e))}};})();
