(()=>{var A=Object.create;var f=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,E=Object.prototype.hasOwnProperty;var D=t=>f(t,"__esModule",{value:!0});var O=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var F=(t,e,o,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of z(e))!E.call(t,r)&&(o||r!=="default")&&f(t,r,{get:()=>e[r],enumerable:!(n=k(e,r))||n.enumerable});return t},L=(t,e)=>F(D(f(t!=null?A(R(t)):{},"default",!e&&t&&t.__esModule?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var v=O((j,g)=>{function P(t,e,o=r=>r,n){let r=o,s=[];for(let a=0;a<t.length;a+=1){let i=a-e,u=i>=0?i:0,m=a+e+1,d=0,l=0;for(let c=u;c<m&&c<t.length;c+=1)l+=r(t[c]),d+=1;s[a]=n?n(t[a],l/d):l/d}return s}g.exports=P});var y=L(v()),h={lineCap:"round",lineWidth:10,maxLines:40,bufferSize:1024};function V(t,e,o){let n=(0,y.default)(o,4),{lineCap:r,lineWidth:s}=h,{width:a,height:i}=t,u=a/n.length;Object.assign(e,{lineWidth:s,lineCap:r}),e.clearRect(0,0,a,i),e.fillStyle="#09070D",e.fillRect(0,0,a,i),e.strokeStyle="#fff",n.forEach((m,d)=>{let l=Math.min(Math.max(m,0),i/3),c=u*(d+1);c>a-u||(e.beginPath(),e.moveTo(c,i/2+l),e.lineTo(c,i/2-l),e.stroke())})}async function M(t,e,o){try{let i=function(){requestAnimationFrame(i),r.getByteFrequencyData(a),V(t,e,a)},n=new AudioContext,r=n.createAnalyser();r.fftSize=h.bufferSize,r.minDecibels=-90,r.maxDecibels=20,r.smoothingTimeConstant=.85,n.createMediaStreamSource(o).connect(r);let a=new Uint8Array(r.frequencyBinCount).slice(0,h.maxLines);requestAnimationFrame(i)}catch(n){console.error(n)}}function C(t,e){let o=document.createElement("canvas");o.width=screen.width,o.height=screen.height;let n=o.getContext("2d");return M(o,n,t),o.captureStream(e)}function p(...t){if(!(t==null?void 0:t.length))throw new Error("No stream was passed");t.forEach(e=>e.getTracks().forEach(o=>{o.stop(),e.removeTrack(o)}))}function x(t){return navigator.mediaDevices.getUserMedia(t)}function b(t,e){let[o]=t.getAudioTracks(),n=new MediaStream([o]),r=new AudioContext,s=r.createMediaStreamSource(n),a=r.createMediaStreamDestination(),i=r.createGain();i.gain.value=e,[s,i,a].reduce((m,d)=>m&&m.connect(d));let[u]=a.stream.getAudioTracks();return t.removeTrack(o),t.addTrack(u),()=>{p(t),p(n),p(a.stream),a.disconnect(),s.disconnect(),r.state!=="closed"&&r.close()}}function T(t,e){return t.getAudioTracks().forEach(o=>e.addTrack(o)),e}var w={constraints:{audio:{autoGainControl:!0,noiseSuppression:!0,echoCancellation:!0,suppressLocalAudioPlayback:!0}},recorder:{mimeType:"video/webm;codecs=vp9,opus"},visualizerFps:60},S=class{options=w;recorder;constructor(e){this.options=Object.assign(w,e)}async init(){var a;let e=await x((a=this.options)==null?void 0:a.constraints),o=C(e,this.options.visualizerFps),n=T(e,o),r=b(n,7),s=new MediaRecorder(n,this.options.recorder);s.onstop=()=>{r(),p(n,e,o)},this.recorder=s}start(){var e;(e=this.recorder)==null||e.start()}stop(){return new Promise(e=>{var o,n;(o=this.recorder)==null||o.addEventListener("dataavailable",r=>e(r.data)),(n=this.recorder)==null||n.stop()})}};})();
