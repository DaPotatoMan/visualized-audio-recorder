var k=Object.create;var m=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var E=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty;var v=t=>m(t,"__esModule",{value:!0});var F=(t,e)=>{for(var r in e)m(t,r,{get:e[r],enumerable:!0})},y=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of R(e))!D.call(t,o)&&(r||o!=="default")&&m(t,o,{get:()=>e[o],enumerable:!(n=z(e,o))||n.enumerable});return t},L=(t,e)=>y(v(m(t!=null?k(E(t)):{},"default",!e&&t&&t.__esModule?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t),O=(t=>(e,r)=>t&&t.get(e)||(r=y(v({}),e,1),t&&t.set(e,r),r))(typeof WeakMap!="undefined"?new WeakMap:0);var V={};F(V,{default:()=>p});var M=L(require("array-smooth")),S={lineCap:"round",lineWidth:10,maxLines:40,bufferSize:1024};function P(t,e,r){let n=(0,M.default)(r,4),{lineCap:o,lineWidth:s}=S,{width:a,height:i}=t,d=a/n.length;Object.assign(e,{lineWidth:s,lineCap:o}),e.clearRect(0,0,a,i),e.fillStyle="#09070D",e.fillRect(0,0,a,i),e.strokeStyle="#fff",n.forEach((u,f)=>{let g=Math.min(Math.max(u,0),i/3),h=d*(f+1);h>a-d||(e.beginPath(),e.moveTo(h,i/2+g),e.lineTo(h,i/2-g),e.stroke())})}async function C(t,e,r){try{let i=function(){requestAnimationFrame(i),o.getByteFrequencyData(a),P(t,e,a)},n=new AudioContext,o=n.createAnalyser();o.fftSize=S.bufferSize,o.minDecibels=-90,o.maxDecibels=20,o.smoothingTimeConstant=.85,n.createMediaStreamSource(r).connect(o);let a=new Uint8Array(o.frequencyBinCount).slice(0,S.maxLines);requestAnimationFrame(i)}catch(n){console.error(n)}}function w(t,e){let r=document.createElement("canvas");r.width=screen.width,r.height=screen.height;let n=r.getContext("2d");return C(r,n,t),r.captureStream(e)}function c(...t){if(!(t==null?void 0:t.length))throw new Error("No stream was passed");t.forEach(e=>e.getTracks().forEach(r=>{r.stop(),e.removeTrack(r)}))}function b(t){return navigator.mediaDevices.getUserMedia(t)}function x(t,e){let[r]=t.getAudioTracks(),n=new MediaStream([r]),o=new AudioContext,s=o.createMediaStreamSource(n),a=o.createMediaStreamDestination(),i=o.createGain();i.gain.value=e,[s,i,a].reduce((u,f)=>u&&u.connect(f));let[d]=a.stream.getAudioTracks();return t.removeTrack(r),t.addTrack(d),()=>{c(t),c(n),c(a.stream),a.disconnect(),s.disconnect(),o.state!=="closed"&&o.close()}}function T(t,e){return t.getAudioTracks().forEach(r=>e.addTrack(r)),e}var A={constraints:{audio:{autoGainControl:!0,noiseSuppression:!0,echoCancellation:!0,suppressLocalAudioPlayback:!0}},recorder:{mimeType:"video/webm;codecs=vp9,opus"},visualizerFps:60},p=class{options=A;recorder;constructor(e){this.options=Object.assign(A,e)}async init(){var a;let e=await b((a=this.options)==null?void 0:a.constraints),r=w(e,this.options.visualizerFps),n=T(e,r),o=x(n,7),s=new MediaRecorder(n,this.options.recorder);s.onstop=()=>{o(),c(n,e,r)},this.recorder=s}start(){var e;(e=this.recorder)==null||e.start()}stop(){return new Promise(e=>{var r,n;(r=this.recorder)==null||r.addEventListener("dataavailable",o=>e(o.data)),(n=this.recorder)==null||n.stop()})}};module.exports=O(V);0&&(module.exports={});
