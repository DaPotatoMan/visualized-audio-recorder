var C=Object.create;var p=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var A=Object.getOwnPropertyNames;var z=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty;var g=t=>p(t,"__esModule",{value:!0});var O=(t,e)=>{for(var r in e)p(t,r,{get:e[r],enumerable:!0})},S=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of A(e))!D.call(t,n)&&(r||n!=="default")&&p(t,n,{get:()=>e[n],enumerable:!(o=L(e,n))||o.enumerable});return t},V=(t,e)=>S(g(p(t!=null?C(z(t)):{},"default",!e&&t&&t.__esModule?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t),q=(t=>(e,r)=>t&&t.get(e)||(r=S(g({}),e,1),t&&t.set(e,r),r))(typeof WeakMap!="undefined"?new WeakMap:0);var H={};O(H,{default:()=>f});function m(...t){if(!(t==null?void 0:t.length))throw new Error("No stream was passed");t.forEach(e=>e.getTracks().forEach(r=>{r.stop(),r.dispatchEvent(new Event("ended")),e.removeTrack(r),e.dispatchEvent(new Event("removetrack"))}))}function y(t){return navigator.mediaDevices.getUserMedia(t)}function E(t,e){let[r]=t.getAudioTracks(),o=new MediaStream([r]),n=new AudioContext,s=n.createMediaStreamSource(o),i=n.createMediaStreamDestination(),c=n.createGain();c.gain.value=e,[s,c,i].reduce((u,l)=>u&&u.connect(l));let[a]=i.stream.getAudioTracks();return t.removeTrack(r),t.addTrack(a),()=>{m(t),m(o),m(i.stream),i.disconnect(),s.disconnect(),n.state!=="closed"&&n.close()}}function w(t,e){return t.getAudioTracks().forEach(r=>e.addTrack(r)),e}function T(t,e){t.getTracks().forEach(r=>r.contentHint=e)}var k=V(require("array-smooth"));var d={lineCap:"round",gap:5,lineWidth:10,maxLines:40,bufferSize:512};function B(t,e,r){let o=(0,k.default)(r,4),{gap:n,lineCap:s,lineWidth:i}=d,{width:c,height:a}=t;Object.assign(e,{lineWidth:i,lineCap:s}),e.clearRect(0,0,c,a),e.fillStyle="#09070D",e.fillRect(0,0,c,a),e.strokeStyle="#fff",o.forEach((u,l)=>{let M=Math.min(Math.max(u,0),a/3),v=n*(l+1);v>c-n||(e.beginPath(),e.moveTo(v,a/2+M),e.lineTo(v,a/2-M),e.stroke())})}async function b(t,e,r){try{let a=function(){!c||(requestAnimationFrame(a),n.getByteFrequencyData(i),B(t,e,i))};d.lineWidth=Math.round(t.width/130),d.gap=Math.round(t.width/(d.lineWidth*2)),d.maxLines=Math.round(t.width/(d.gap-d.lineWidth));let o=new AudioContext,n=o.createAnalyser();n.fftSize=d.bufferSize,n.minDecibels=-90,n.maxDecibels=20,n.smoothingTimeConstant=.85;let s=r.clone();o.createMediaStreamSource(s).connect(n);let i=new Uint8Array(n.frequencyBinCount).slice(0,d.maxLines),c=!0;r.addEventListener("removetrack",()=>{m(s),console.info("Stopping canvas drawing"),e.clearRect(0,0,t.width,t.height),c=!1}),requestAnimationFrame(a)}catch(o){console.error(o)}}function x(t,e){let r=document.createElement("canvas");if(!(r==null?void 0:r.captureStream))throw new Error("This browser does not support captureStream");let o=16/9,n=720;r.width=n*o,r.height=n;let s=r.getContext("2d");b(r,s,t);let i=r.captureStream(e);return T(i,"detail"),i}var R={constraints:{audio:!0},fps:24},f=class{options=R;recorder;chunks=[];constructor(e){this.options=Object.assign(R,e)}async init(){this.destroy();let{constraints:e,recorder:r,amplify:o,fps:n}=this.options,s=await y(e),i=x(s,n),c=w(s,i),a;o&&o>1&&(a=E(c,o)),this.recorder=new MediaRecorder(c,r),this.recorder.addEventListener("stop",()=>{m(c,s,i),a==null||a()}),this.recorder.addEventListener("dataavailable",u=>u.data.size>0&&this.chunks.push(u.data))}start(){var e;(e=this.recorder)==null||e.start()}stop(){let e=this.recorder;if(!(!e||(e==null?void 0:e.state)==="inactive"))return new Promise(r=>{e.addEventListener("stop",()=>{let o=new Blob(this.chunks,{type:e.mimeType});r(o)}),e.stop()})}destroy(){this.recorder&&(this.recorder.stop(),this.recorder=void 0),this.chunks=[]}on(e,r,o){var n;(n=this.recorder)==null||n.addEventListener(e,r,o)}off(e,r,o){var n;(n=this.recorder)==null||n.removeEventListener(e,r,o)}emit(e){var r;(r=this.recorder)==null||r.dispatchEvent(new Event(e))}};module.exports=q(H);0&&(module.exports={});
