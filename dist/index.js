var A=Object.create;var l=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var L=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty;var v=t=>l(t,"__esModule",{value:!0});var F=(t,e)=>{for(var r in e)l(t,r,{get:e[r],enumerable:!0})},y=(t,e,r,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of R(e))!D.call(t,o)&&(r||o!=="default")&&l(t,o,{get:()=>e[o],enumerable:!(i=z(e,o))||i.enumerable});return t},O=(t,e)=>y(v(l(t!=null?A(L(t)):{},"default",!e&&t&&t.__esModule?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t),q=(t=>(e,r)=>t&&t.get(e)||(r=y(v({}),e,1),t&&t.set(e,r),r))(typeof WeakMap!="undefined"?new WeakMap:0);var P={};F(P,{default:()=>h});function u(...t){if(!(t==null?void 0:t.length))throw new Error("No stream was passed");t.forEach(e=>e.getTracks().forEach(r=>{r.stop(),r.dispatchEvent(new Event("ended")),e.removeTrack(r),e.dispatchEvent(new Event("removetrack"))}))}function M(t){return navigator.mediaDevices.getUserMedia(t)}function w(t,e){let[r]=t.getAudioTracks(),i=new MediaStream([r]),o=new AudioContext,n=o.createMediaStreamSource(i),a=o.createMediaStreamDestination(),d=o.createGain();d.gain.value=e,[n,d,a].reduce((m,f)=>m&&m.connect(f));let[s]=a.stream.getAudioTracks();return t.removeTrack(r),t.addTrack(s),()=>{u(t),u(i),u(a.stream),a.disconnect(),n.disconnect(),o.state!=="closed"&&o.close()}}function C(t,e){return t.getAudioTracks().forEach(r=>e.addTrack(r)),e}function T(t,e){t.getTracks().forEach(r=>r.contentHint=e)}var k=O(require("array-smooth")),c={lineCap:"round",gap:5,lineWidth:10,maxLines:40,bufferSize:512};function H(t,e,r){let i=(0,k.default)(r,4),{gap:o,lineCap:n,lineWidth:a}=c,{width:d,height:s}=t;Object.assign(e,{lineWidth:a,lineCap:n}),e.clearRect(0,0,d,s),e.fillStyle="#09070D",e.fillRect(0,0,d,s),e.strokeStyle="#fff",i.forEach((m,f)=>{let S=Math.min(Math.max(m,0),s/3),g=o*(f+1);g>d-o||(e.beginPath(),e.moveTo(g,s/2+S),e.lineTo(g,s/2-S),e.stroke())})}async function x(t,e,r){try{let s=function(){!d||(requestAnimationFrame(s),o.getByteFrequencyData(a),H(t,e,a))};c.lineWidth=Math.round(t.width/130),c.gap=Math.round(t.width/(c.lineWidth*2)),c.maxLines=Math.round(t.width/(c.gap-c.lineWidth)),console.log(c);let i=new AudioContext,o=i.createAnalyser();o.fftSize=c.bufferSize,o.minDecibels=-90,o.maxDecibels=20,o.smoothingTimeConstant=.85,i.createMediaStreamSource(r).connect(o);let a=new Uint8Array(o.frequencyBinCount).slice(0,c.maxLines),d=!0;r.addEventListener("removetrack",()=>{console.info("Stopping canvas drawing"),e.clearRect(0,0,t.width,t.height),d=!1}),requestAnimationFrame(s)}catch(i){console.error(i)}}function b(t,e){let r=document.createElement("canvas"),i=16/9,o=720;r.width=o*i,r.height=o;let n=r.getContext("2d");x(r,n,t);let a=r.captureStream(e);return T(a,"detail"),a}var E={constraints:{audio:{autoGainControl:!0,noiseSuppression:!0,echoCancellation:!0,suppressLocalAudioPlayback:!0}},recorder:{mimeType:"video/webm;codecs=vp9,opus"},visualizerFps:60},h=class{options=E;recorder;constructor(e){this.options=Object.assign(E,e)}async init(){var n;this.destroy();let e=await M((n=this.options)==null?void 0:n.constraints),r=b(e,this.options.visualizerFps),i=C(e,r),o=w(i,7);this.recorder=new MediaRecorder(i,this.options.recorder),this.recorder.addEventListener("stop",()=>{o(),u(i,e,r)})}start(){var e;(e=this.recorder)==null||e.start()}stop(){var e;if(((e=this.recorder)==null?void 0:e.state)!=="inactive")return new Promise(r=>{var i,o;(i=this.recorder)==null||i.addEventListener("dataavailable",n=>r(n.data)),(o=this.recorder)==null||o.stop()})}destroy(){this.recorder&&(this.recorder.stop(),this.recorder=void 0)}};module.exports=q(P);0&&(module.exports={});
