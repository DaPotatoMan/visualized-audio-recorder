import x from"array-smooth";var h={lineCap:"round",lineWidth:10,maxLines:40,bufferSize:1024};function T(r,e,t){let o=x(t,4),{lineCap:n,lineWidth:s}=h,{width:a,height:i}=r,d=a/o.length;Object.assign(e,{lineWidth:s,lineCap:n}),e.clearRect(0,0,a,i),e.fillStyle="#09070D",e.fillRect(0,0,a,i),e.strokeStyle="#fff",o.forEach((u,p)=>{let g=Math.min(Math.max(u,0),i/3),f=d*(p+1);f>a-d||(e.beginPath(),e.moveTo(f,i/2+g),e.lineTo(f,i/2-g),e.stroke())})}async function v(r,e,t){try{let i=function(){requestAnimationFrame(i),n.getByteFrequencyData(a),T(r,e,a)},o=new AudioContext,n=o.createAnalyser();n.fftSize=h.bufferSize,n.minDecibels=-90,n.maxDecibels=20,n.smoothingTimeConstant=.85,o.createMediaStreamSource(t).connect(n);let a=new Uint8Array(n.frequencyBinCount).slice(0,h.maxLines);requestAnimationFrame(i)}catch(o){console.error(o)}}function y(r,e){let t=document.createElement("canvas");t.width=screen.width,t.height=screen.height;let o=t.getContext("2d");return v(t,o,r),t.captureStream(e)}function c(...r){if(!(r==null?void 0:r.length))throw new Error("No stream was passed");r.forEach(e=>e.getTracks().forEach(t=>{t.stop(),e.removeTrack(t)}))}function M(r){return navigator.mediaDevices.getUserMedia(r)}function C(r,e){let[t]=r.getAudioTracks(),o=new MediaStream([t]),n=new AudioContext,s=n.createMediaStreamSource(o),a=n.createMediaStreamDestination(),i=n.createGain();i.gain.value=e,[s,i,a].reduce((u,p)=>u&&u.connect(p));let[d]=a.stream.getAudioTracks();return r.removeTrack(t),r.addTrack(d),()=>{c(r),c(o),c(a.stream),a.disconnect(),s.disconnect(),n.state!=="closed"&&n.close()}}function w(r,e){return r.getAudioTracks().forEach(t=>e.addTrack(t)),e}var b={constraints:{audio:{autoGainControl:!0,noiseSuppression:!0,echoCancellation:!0,suppressLocalAudioPlayback:!0}},recorder:{mimeType:"video/webm;codecs=vp9,opus"},visualizerFps:60},S=class{options=b;recorder;constructor(e){this.options=Object.assign(b,e)}async init(){var a;let e=await M((a=this.options)==null?void 0:a.constraints),t=y(e,this.options.visualizerFps),o=w(e,t),n=C(o,7),s=new MediaRecorder(o,this.options.recorder);s.onstop=()=>{n(),c(o,e,t)},this.recorder=s}start(){var e;(e=this.recorder)==null||e.start()}stop(){return new Promise(e=>{var t,o;(t=this.recorder)==null||t.addEventListener("dataavailable",n=>e(n.data)),(o=this.recorder)==null||o.stop()})}};export{S as default};
